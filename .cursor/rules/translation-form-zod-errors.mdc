---
alwaysApply: false
description: "Guidelines for using customErrors with Zod and organizing form-related translation keys in next-intl."
---
# Translation Best Practices for Forms and Zod Errors

This rule outlines the recommended practices for integrating Zod validation with `next-intl` for localized error messages, and how to structure translation files for form components.

## 1. Custom Errors in Zod Schema (with `next-intl`)

To use custom error messages with Zod and `next-intl`, you typically define an error map or use direct messages in your schema.

### Translation File Structure for Zod Errors

It is recommended to have a dedicated translation file for Zod errors, for example:

```json
// apps/codehouse/messages/zod/{locale}.json
{
  "zod": {
    "errors": {
      "string_min": "Must be at least {min} characters long",
      "string_max": "Must be at most {max} characters long",
      "string_email": "Invalid email address",
      "string_required": "This field is required",
      "number_min": "Must be at least {min}",
      "number_max": "Must be at most {max}",
      "invalid_type": "Invalid type for field"
    }
  }
}
```

### Zod Error Map Implementation

Create an error map that utilizes the `t` function from `next-intl` to retrieve these localized messages. This is often done in a utility file (e.g., `packages/i18n/src/zod.ts`):

```typescript
// packages/i18n/src/zod.ts (example structure)
import { ZodErrorMap, z } from 'zod';
import { createI18n } from './request'; // Or your equivalent for server components

export const createZodI18n = (locale: string): ZodErrorMap => {
  const { t } = createI18n(locale, 'zod'); // 'zod' would be your namespace

  return (issue, ctx) => {
    let message: string;
    switch (issue.code) {
      case z.ZodIssueCode.too_small:
        if (issue.type === 'string') {
          message = t('zod.errors.string_min', { min: issue.minimum });
        } else if (issue.type === 'number') {
          message = t('zod.errors.number_min', { min: issue.minimum });
        } else {
          message = ctx.defaultError;
        }
        break;
      // ... handle other ZodIssueCodes
      case z.ZodIssueCode.invalid_type:
        if (issue.received === 'undefined') {
          message = t('zod.errors.string_required');
        } else {
          message = t('zod.errors.invalid_type');
        }
        break;
      default:
        message = ctx.defaultError;
    }
    return { message };
  };
};
```

### Direct Custom Error Messages in Zod Schema

For highly specific error messages, you can embed them directly within your Zod schema using the `message` option, retrieving them via `useTranslations` from a component-specific namespace:

```typescript
import { z } from 'zod';
import { useTranslations } from 'next-intl';

export function ContactFormSchema() {
  const t = useTranslations('ContactForm'); // Component namespace

  return z.object({
    name: z.string().min(1, { message: t('form_name_required') }),
    email: z.string().email({ message: t('form_email_invalid') }),
    // ... other fields
  });
}
```

And in your component's translation file (e.g., `apps/codehouse/messages/en.json`):

```json
// apps/codehouse/messages/en.json
{
  "ContactForm": {
    "form_name_required": "Please enter your name.",
    "form_email_invalid": "Please enter a valid email address."
  }
}
```

## 2. Organizing Form Keys in Translation Files

Adhere to the project's "Translation Management Rules" by organizing form-related translations under the component name, often nested within a `form` key for clarity.

### Example Translation File Structure for a Form

```json
// apps/codehouse/messages/en.json
{
  "ContactForm": {
    "title": "Contact Us",
    "description": "We'd love to hear from you!",
    "form": {
      "name_label": "Your Name",
      "name_placeholder": "Enter your name",
      "email_label": "Your Email",
      "email_placeholder": "Enter your email",
      "message_label": "Your Message",
      "message_placeholder": "Type your message here",
      "submit_button": "Send Message",
      "success_message": "Thank you for your message! We will get back to you shortly.",
      "error_message": "There was an error sending your message. Please try again."
    }
  }
}
```

### Usage in a Component

Access these translations using the `useTranslations` hook with the appropriate namespace and dot notation:

```typescript
// apps/codehouse/src/app/[locale]/sections/components/contact-form.tsx
'use client';

import { useTranslations } from 'next-intl';
// ... other imports

export function ContactForm() {
  const t = useTranslations('ContactForm');

  return (
    <form>
      <h1>{t('title')}</h1>
      <label htmlFor="name">{t('form.name_label')}</label>
      <input id="name" placeholder={t('form.name_placeholder')} />
      {/* ... other form fields */}
      <button type="submit">{t('form.submit_button')}</button>
    </form>
  );
}
```

By following these guidelines, you can ensure consistent, maintainable, and internationalized forms with robust Zod validation across your application.